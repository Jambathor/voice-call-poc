<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Call POC</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Voice Call POC</h1>
        <div id="join-form">
            <input type="text" id="username" placeholder="Enter your name" required>
            <input type="text" id="roomName" placeholder="Enter room name" required>
            <button id="joinBtn">Join Room</button>
        </div>
        
        <div id="call-controls" style="display: none;">
            <h2 id="roomDisplay"></h2>
            <p id="participantName"></p>
            <button id="leaveBtn">Leave Room</button>
            <div id="audioStatus">
                <button id="muteBtn">Mute</button>
            </div>
        </div>

        <div id="status-messages"></div>
        <div id="debug-info" style="margin-top: 20px; font-size: 12px; color: #666;"></div>
    </div>

    <!-- Load env.js first and ensure it's loaded -->
    <script>
        // Debug information display
        function updateDebugInfo(message) {
            const debugDiv = document.getElementById('debug-info');
            const timestamp = new Date().toISOString();
            debugDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        }

        // Create a promise to track env.js loading
        window.envLoaded = new Promise((resolve, reject) => {
            const envScript = document.createElement('script');
            envScript.src = 'env.js';
            envScript.onload = () => {
                updateDebugInfo('env.js loaded');
                if (window.AGORA_APP_ID) {
                    updateDebugInfo('AGORA_APP_ID found after env.js load');
                } else {
                    updateDebugInfo('AGORA_APP_ID not found after env.js load');
                }
                resolve();
            };
            envScript.onerror = () => {
                updateDebugInfo('Failed to load env.js');
                reject(new Error('Failed to load env.js'));
            };
            document.head.appendChild(envScript);
        });

        // Error handler for script loading
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            updateDebugInfo(`Error: ${msg} at ${url}:${lineNo}`);
            return false;
        };
    </script>

    <!-- Load other scripts after env.js -->
    <script>
        window.envLoaded.then(() => {
            updateDebugInfo('Loading Agora SDK...');
            const agoraScript = document.createElement('script');
            agoraScript.src = 'https://download.agora.io/sdk/release/AgoraRTC_N.js';
            agoraScript.onload = () => {
                updateDebugInfo('Agora SDK loaded');
                // Load app.js only after Agora SDK is loaded
                const appScript = document.createElement('script');
                appScript.src = 'app.js';
                appScript.onload = () => updateDebugInfo('app.js loaded');
                appScript.onerror = () => updateDebugInfo('Failed to load app.js');
                document.body.appendChild(appScript);
            };
            agoraScript.onerror = () => updateDebugInfo('Failed to load Agora SDK');
            document.body.appendChild(agoraScript);
        }).catch(error => {
            updateDebugInfo(`Failed to initialize: ${error.message}`);
        });
    </script>
</body>
</html> 